<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Stateless-dns-go by taskcluster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Stateless-dns-go</h1>
      <h2 class="project-tagline">A go (golang) port of https://github.com/taskcluster/stateless-dns-server/blob/master/index.js</h2>
      <a href="https://github.com/taskcluster/stateless-dns-go" class="btn">View on GitHub</a>
      <a href="https://github.com/taskcluster/stateless-dns-go/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/taskcluster/stateless-dns-go/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="stateless-dns-go" class="anchor" href="#stateless-dns-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>stateless-dns-go</h1>

<p><img src="https://tools.taskcluster.net/lib/assets/taskcluster-120.png"></p>

<p>A go (golang) port of <a href="https://github.com/taskcluster/stateless-dns-server/blob/master/index.js">https://github.com/taskcluster/stateless-dns-server/blob/master/index.js</a></p>

<p><a href="https://godoc.org/github.com/taskcluster/stateless-dns-go"><img src="https://godoc.org/github.com/taskcluster/stateless-dns-go?status.svg" alt="GoDoc"></a>
<a href="http://travis-ci.org/taskcluster/stateless-dns-go"><img src="https://travis-ci.org/taskcluster/stateless-dns-go.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/taskcluster/stateless-dns-go?branch=master"><img src="https://coveralls.io/repos/taskcluster/stateless-dns-go/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a>
<a href="https://github.com/taskcluster/stateless-dns-go/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-MPL%202.0-orange.svg" alt="License"></a></p>

<p>stateless-dns-go provides:</p>

<ul>
<li>A go (golang) package for generating client dns names that can be used in
conjunction with <a href="https://github.com/taskcluster/stateless-dns-server">https://github.com/taskcluster/stateless-dns-server</a>, that
can be directly imported in go applications</li>
<li>A command line utility to expose the features of the library, which can be
called from any language</li>
</ul>

<p>Domains generated by this library encode an IP-address, expiration date, a
random salt and an HMAC-SHA256 signature truncated to 128 bits.</p>

<p>This provides a mechanism to assign temporary sub-domains names to nodes with a
public IP-address. The same problem can also be solved with dynamic DNS server,
but such entries often requires clean-up. The beauty of this approach is that
the DNS server is state-less, so there is no stale DNS records to discard.</p>

<p>In TaskCluster this is used to assign temporary sub-domain names to EC2 spot
nodes, such that we can host HTTPS resources, such as live logs, without
updating and cleaning up the state of the DNS server.</p>

<p>Notice, that with IP-address, expiration date, random salt and HMAC-SHA256
signature encoded in the sub-domain label, you cannot decide which sub-domain
label you wish to have. Hence, this is only useful in cases were the hostname
for your node is transmitted to clients by other means, for example in a
message over RabbitMQ or as temporary entry in a database. Further more, to
serve HTTPS content you'll need a wild-card SSL certificate, for domain managed
by this DNS server.</p>

<p>Note, this obviously doesn't have many applications, as the sub-domain label is
stateful. It's mostly for serving HTTPS content from nodes that come and go
quickly with minimal setup, where the hostname is transmitted by other means.
Generally, any case where you might consider using the default EC2 hostname.</p>

<h2>
<a id="sub-domain-label-generation" class="anchor" href="#sub-domain-label-generation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sub-domain Label Generation</h2>

<p>The sub-domain label encodes the following parameters:</p>

<ul>
<li>
<code>ip</code>, address to which the <code>A</code> record returned should point,</li>
<li>
<code>expires</code>, expiration of sub-domain as number of ms since epoch,</li>
<li>
<code>salt</code>, random salt, allowing for generation of multiple sub-domain labels
for each IP-address, and,</li>
<li>
<code>signature</code>, HMAC-SHA256 signature of <code>ip</code>, <code>expires</code> and <code>salt</code> truncated
to 128 bit.</li>
</ul>

<p>The <code>expires</code> property is encoded as a big-endian 64 bit signed integer. The
<code>salt</code> property is encoded as bit-endian 16 bit unsigned integer. All
properties are concatenated and base32 (RFC 3548) encoded to form the
sub-domain label.</p>

<h2>
<a id="go-library-usage" class="anchor" href="#go-library-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Go library usage</h2>

<p>Here is a silly example:</p>

<div class="highlight highlight-source-go"><pre><span class="pl-k">import</span> (
    <span class="pl-s"><span class="pl-pds">"</span>fmt<span class="pl-pds">"</span></span>
    <span class="pl-s"><span class="pl-pds">"</span>net<span class="pl-pds">"</span></span>
    <span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>

    <span class="pl-s"><span class="pl-pds">"</span>github.com/taskcluster/stateless-dns-go/hostname<span class="pl-pds">"</span></span>
)

<span class="pl-k">func</span> <span class="pl-en">PrintHostname</span>() {
    <span class="pl-smi">ip</span> <span class="pl-k">:=</span> net.<span class="pl-c1">IPv4</span>(<span class="pl-k">byte</span>(<span class="pl-c1">203</span>), <span class="pl-c1">byte</span>(<span class="pl-c1">43</span>), <span class="pl-c1">byte</span>(<span class="pl-c1">55</span>), <span class="pl-c1">byte</span>(<span class="pl-c1">2</span>))
    <span class="pl-smi">subdomain</span> <span class="pl-k">:=</span> <span class="pl-s"><span class="pl-pds">"</span>foo.com<span class="pl-pds">"</span></span>
    <span class="pl-smi">expires</span> <span class="pl-k">:=</span> time.<span class="pl-c1">Now</span>().<span class="pl-c1">Add</span>(<span class="pl-c1">15</span> * time.<span class="pl-smi">Minute</span>)
    <span class="pl-smi">secret</span> <span class="pl-k">:=</span> <span class="pl-s"><span class="pl-pds">"</span>turnip-4tea-2nite<span class="pl-pds">"</span></span>
    <span class="pl-smi">name</span>, <span class="pl-smi">err</span> <span class="pl-k">:=</span> hostname.<span class="pl-c1">New</span>(ip, subdomain, expires, secret)
    <span class="pl-k">if</span> err != <span class="pl-c1">nil</span> {
        <span class="pl-c1">panic</span>(err)
    }
    fmt.<span class="pl-c1">Printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Hostname: '<span class="pl-c1">%s</span>'<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, name)
}</pre></div>

<h2>
<a id="installing-command-line-tool" class="anchor" href="#installing-command-line-tool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing command line tool</h2>

<p><strong>Binary installation</strong></p>

<p>Download the create-hostname command line tool for your platform from
<a href="https://github.com/taskcluster/stateless-dns-go/releases">here</a>.</p>

<p><strong>Source installation</strong></p>

<p>Requirements:</p>

<ul>
<li>go (golang) v1.4 or higher</li>
<li>
<code>${GOPATH}/bin</code> is in your path</li>
</ul>

<p>Run:</p>

<pre><code>go get github.com/taskcluster/stateless-dns-go/create-hostname
</code></pre>

<h2>
<a id="command-line-usage" class="anchor" href="#command-line-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Command line usage</h2>

<pre><code>Usage:
  create-hostname --ip IP --subdomain SUBDOMAIN --expires EXPIRES --secret SECRET
  create-hostname -h|--help
  create-hostname --version

Exit Codes:
   0: Success
   1: Unrecognised command line options
  64: Invalid IP given
  65: IP given was an IPv6 IP (IP should be an IPv4 IP)
  66: Invalid SUBDOMAIN given
  67: Invalid EXPIRES given
  68: Invalid SECRET given
  69: Some other problem

Examples:
  $ create-hostname --ip 203.115.35.2 --subdomain foo.com --expires 2016-06-04T16:04:03.739Z --secret 'cheese monkey'
  znzsgaqaau2hl7h35f4owqn25s76j4h7apm3fe4qpy6pfxjk.foo.com
</code></pre>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>The stateless-dns-go library is released on the MPL 2.0 license, see file
<code>LICENSE</code> for the complete license.</p>

<h2>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h2>

<div class="highlight highlight-source-shell"><pre>go <span class="pl-c1">test</span> ./...</pre></div>

<p>TODO: write tests!</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/taskcluster/stateless-dns-go">Stateless-dns-go</a> is maintained by <a href="https://github.com/taskcluster">taskcluster</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
